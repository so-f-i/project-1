import streamlit as st
import pandas as pd
import plotly.express as px


st.set_page_config(
    page_title="–ê–Ω–∞–ª–∏–∑ —á–∞—Ä—Ç–æ–≤ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏",
    layout="wide",
    initial_sidebar_state="expanded"
)
# –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
@st.cache_data
def load_data():
    try:
    
        data_url = "https://raw.githubusercontent.com/so-f-i/project-1/main/data/chart_clean.csv"
        df = pd.read_csv(data_url)
        return df
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: {e}")
        return None

# –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
df = load_data()

if df is None:
    st.stop()  

# –ù–∞–≤–∏–≥–∞—Ü–∏—è
st.sidebar.title("–ù–∞–≤–∏–≥–∞—Ü–∏—è")
page = st.sidebar.radio(
    "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:",
    ("–ì–ª–∞–≤–Ω–∞—è", "–î–∞–Ω–Ω—ã–µ", "EDA", "–¢—Ä–µ–Ω–¥—ã", "–í—ã–≤–æ–¥—ã")
)

# –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
if page == "–ì–ª–∞–≤–Ω–∞—è":
    st.title("–ê–Ω–∞–ª–∏–∑ —á–∞—Ä—Ç–∞ –¢–æ–ø-100 –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏")
    st.markdown("""
    **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥—ç—à–±–æ—Ä–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–∫—Ç–æ—Ä–æ–≤, –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ —Ç—Ä–µ–∫–æ–≤ –≤ —á–∞—Ä—Ç–∞—Ö.**
    
    **–û–ø–∏—Å–∞–Ω–∏–µ:** –ú—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ —á–∞—Ä—Ç "–¢–æ–ø-100" –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫ —Ñ–∞–∫—Ç–æ—Ä—ã ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–µ–∫–∞, –∂–∞–Ω—Ä, –≥–æ–¥ –≤—ã–ø—É—Å–∫–∞ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏—è ‚Äî –≤–ª–∏—è—é—Ç –Ω–∞ —É—Å–ø–µ—Ö –ø–µ—Å–Ω–∏. –≠—Ç–æ—Ç –∞–Ω–∞–ª–∏–∑ –ø–æ–º–æ–∂–µ—Ç –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã –∏ —É–∑–Ω–∞—Ç—å, —á—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É—Å–ø–µ—Ö –ø–µ—Å–µ–Ω –≤ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö —á–∞—Ä—Ç–∞—Ö
    
    **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** API –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏ (—Ç–æ–ø-100 —Ç—Ä–µ–∫–æ–≤)
    
    **–°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∫–ª—é—á–∞—é—Ç:** –Ω–∞–∑–≤–∞–Ω–∏—è –∏ id —Ç—Ä–µ–∫–æ–≤, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π, –ø–æ–∑–∏—Ü–∏–∏ –≤ —á–∞—Ä—Ç–µ, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∂–∞–Ω—Ä—ã –∏ –≥–æ–¥ –≤—ã–ø—É—Å–∫–∞, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –ø–µ—Å–µ–Ω.
    """)


# –†–∞–∑–¥–µ–ª "–î–∞–Ω–Ω—ã–µ"
elif page == "–î–∞–Ω–Ω—ã–µ":
    st.header("–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ")

    # –§–∏–ª—å—Ç—Ä—ã
    genre_filter = st.multiselect(
        "–§–∏–ª—å—Ç—Ä –ø–æ –∂–∞–Ω—Ä–∞–º",
        options=df['Genre'].unique()
    )

    year_filter = st.slider(
        "–§–∏–ª—å—Ç—Ä –ø–æ –≥–æ–¥—É –≤—ã–ø—É—Å–∫–∞",
        min_value=int(df['Year'].min()),
        max_value=int(df['Year'].max()),
        value=(int(df['Year'].min()), int(df['Year'].max()))
    )

    # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    filtered_df = df.copy()
    if genre_filter:
        filtered_df = filtered_df[filtered_df['Genre'].isin(genre_filter)]
    filtered_df = filtered_df[
        (filtered_df['Year'] >= year_filter[0]) &
        (filtered_df['Year'] <= year_filter[1])
        ]

    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    col1, col2, col3 = st.columns(3)
    with col1:
        st.metric("–í—Å–µ–≥–æ —Ç—Ä–µ–∫–æ–≤", len(filtered_df))
    with col2:
        st.metric("–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∂–∞–Ω—Ä–æ–≤", filtered_df['Genre'].nunique())
    with col3:
        st.metric("–ì–æ–¥—ã –≤—ã–ø—É—Å–∫–∞", f"{year_filter[0]} - {year_filter[1]}")

    # –¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö
    st.dataframe(
        filtered_df,
        use_container_width=True,
        hide_index=True,
        column_config={
            "Position": st.column_config.NumberColumn("–ü–æ–∑–∏—Ü–∏—è", format="%d"),
            "Duration_sec": st.column_config.ProgressColumn(
                "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
                format="%f —Å",
                min_value=0,
                max_value=500
            )
        }
    )

# –†–∞–∑–¥–µ–ª EDA
elif page == "EDA":
    st.header("–†–∞–∑–≤–µ–¥–æ—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö")

    tab1, tab2, tab3 = st.tabs(["–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∂–∞–Ω—Ä–æ–≤", "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–µ–∫–æ–≤", "–ì–æ–¥—ã –≤—ã–ø—É—Å–∫–∞"])

    with tab1:
        genre_counts = df['Genre'].value_counts().reset_index()
        fig = px.pie(
            genre_counts,
            names='Genre',
            values='count',
            title='–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∂–∞–Ω—Ä–∞–º'
        )
        st.plotly_chart(fig, use_container_width=True)

    with tab2:
        fig = px.histogram(
            df,
            x='Duration_sec',
            nbins=20,
            title='–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç—Ä–µ–∫–æ–≤'
        )
        st.plotly_chart(fig, use_container_width=True)

    with tab3:
        fig = px.histogram(
            df,
            x='Year',
            title='–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥–æ–¥–∞–º –≤—ã–ø—É—Å–∫–∞'
        )
        st.plotly_chart(fig, use_container_width=True)

# –†–∞–∑–¥–µ–ª "–¢—Ä–µ–Ω–¥—ã"
elif page == "–¢—Ä–µ–Ω–¥—ã":
    st.header("–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤")

    # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
    analysis_type = st.selectbox(
        "–í—ã–±–µ—Ä–∏—Ç–µ –∞–Ω–∞–ª–∏–∑:",
        ["–í–ª–∏—è–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏", "–í–ª–∏—è–Ω–∏–µ –∂–∞–Ω—Ä–∞", "–í–ª–∏—è–Ω–∏–µ –≥–æ–¥–∞ –≤—ã–ø—É—Å–∫–∞"]
    )

    if analysis_type == "–í–ª–∏—è–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏":
        fig = px.scatter(
            df,
            x='Position',
            y='Duration_sec',
            trendline="lowess",
            title='–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç—Ä–µ–∫–∞'
        )
        st.plotly_chart(fig, use_container_width=True)

    elif analysis_type == "–í–ª–∏—è–Ω–∏–µ –∂–∞–Ω—Ä–∞":
        top_genres = st.slider(
            "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–ø–æ–≤—ã—Ö –∂–∞–Ω—Ä–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞",
            2, 10, 5
        )
        top_genres_list = df['Genre'].value_counts().head(top_genres).index
        filtered_df = df[df['Genre'].isin(top_genres_list)]

        fig = px.box(
            filtered_df,
            x='Genre',
            y='Position',
            title='–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –ø–æ –∂–∞–Ω—Ä–∞–º'
        )
        st.plotly_chart(fig, use_container_width=True)

    elif analysis_type == "–í–ª–∏—è–Ω–∏–µ –≥–æ–¥–∞ –≤—ã–ø—É—Å–∫–∞":
        fig = px.scatter(
            df,
            x='Year',
            y='Position',
            trendline="lowess",
            title='–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –æ—Ç –≥–æ–¥–∞ –≤—ã–ø—É—Å–∫–∞'
        )
        st.plotly_chart(fig, use_container_width=True)

elif page == "–í—ã–≤–æ–¥—ã":
    st.header("–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏")

    # –ò–Ω—Å–∞–π—Ç 1
    st.markdown("""
    > üéµ **–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 3‚Äì4 –º–∏–Ω—É—Ç—ã  
    > *–≠—Ç–æ –∑–æ–ª–æ—Ç–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞ –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–µ–º–æ—Å—Ç–∏ –∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –ò—Å–∫–ª—é—á–µ–Ω–∏—è ‚Äî –ø–µ—Å–Ω–∏, –≥–¥–µ —É–∑–Ω–∞–≤–∞–µ–º–æ—Å—Ç—å –∞—Ä—Ç–∏—Å—Ç–∞ –≤–∞–∂–Ω–µ–µ –¥–ª–∏–Ω—ã.*  
    """)

    # –ò–Ω—Å–∞–π—Ç 2
    st.markdown("""
    > üÜï **–ù–æ–≤–∏–∑–Ω–∞ –≤ —á–∞—Ä—Ç–µ**: 83% —Ç—Ä–µ–∫–æ–≤ ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –≥–æ–¥–∞  
    > *–†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–µ–ª–∏–∑—ã ‚Äî –∑–∞–ª–æ–≥ —É—Å–ø–µ—Ö–∞. –°—Ç–∞—Ä—ã–µ –ø–µ—Å–Ω–∏ –∑–∞–∫—Ä–µ–ø–ª—è—é—Ç—Å—è –∫–∞–∫ –∫—É–ª—å—Ç–æ–≤—ã–µ –∏–ª–∏ –≤–∏—Ä—É—Å–Ω—ã–µ –º–µ–º—ã.*  
    """)

    # –ò–Ω—Å–∞–π—Ç 3
    st.markdown("""
    > üé§ **–ñ–∞–Ω—Ä—ã-–ª–∏–¥–µ—Ä—ã**: –†—É—Å—Å–∫–∏–π –ø–æ–ø –∏ —Ä—ç–ø  
    > *–û–±–ª–∞–¥–∞–µ—Ç 73% —Ç–æ–ø–∞, –Ω–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –≤—ã—Å–æ–∫–∞—è. –ß—Ç–æ–±—ã –≤—ã–¥–µ–ª–∏—Ç—å—Å—è ‚Äî –Ω—É–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–ª–∏ —Ç–æ—á–Ω–æ –ø–æ–ø–∞–¥–∞—Ç—å –≤ —Ç—Ä–µ–Ω–¥—ã. –§–æ–Ω–∫ –ø–æ–∫–∞ –Ω–∏—à–∞, –Ω–æ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω–∞—è.*  
    """)

    # –ò–Ω—Å–∞–π—Ç 4
    st.markdown("""
    > ‚ú® **–ù–∞–∑–≤–∞–Ω–∏—è**: –ü—Ä–æ—Å—Ç—ã–µ, –∑–∞–ø–æ–º–∏–Ω–∞—é—â–∏–µ—Å—è —Å–ª–æ–≤–∞  
    > *"–•—É–¥–∏", "–ù–µ –Ω—É–∂–Ω–∞" ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∑–∞–ø–æ–º–∏–Ω–∞—é—Ç—Å—è –∏ –≤—ã–∑—ã–≤–∞—é—Ç –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏. –û—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è TikTok-—ç–ø–æ—Ö–∏, –≥–¥–µ —Å–µ–∫—É–Ω–¥–∞ —Ä–µ—à–∞–µ—Ç –≤—Å—ë.*  
    """)

    # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∞—Ä—Ç–∏—Å—Ç–æ–≤
    st.subheader("–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∞—Ä—Ç–∏—Å—Ç–æ–≤")
    st.markdown("""
    1. –†–µ–≥—É–ª—è—Ä–Ω–æ –≤—ã–ø—É—Å–∫–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Ç—Ä–µ–∫–∏ ‚Äî 3-5 –≤ –≥–æ–¥.  
    2. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –¥–ª–∏–Ω—É ‚Äî 3‚Äì4 –º–∏–Ω—É—Ç—ã.  
    3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–ø–æ–º–∏–Ω–∞—é—â–∏–µ—Å—è –Ω–∞–∑–≤–∞–Ω–∏—è ‚Äî –ø—Ä–æ—Å—Ç—ã–µ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ.  
    4. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∏—à–µ–≤—ã–µ –∂–∞–Ω—Ä—ã, —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—é.  
    """)

    # –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ
    st.subheader("–î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ")
    st.markdown("""
    - –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–æ–≤ –ø–µ—Å–µ–Ω (–ø—Ä–æ–±–ª–µ–º–∞ —Å API —Ç–µ–∫—Å—Ç–æ–≤).  
    - –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –≤–ª–∏—è–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–ª–∏–∑–∞.  
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤—è–∑—å —Å –ø–ª–µ–π–ª–∏—Å—Ç–∞–º–∏.  
    - –í–Ω–µ–¥—Ä–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ Shazam –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–π –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏.  
    - –ü—Ä–æ–≤–µ—Å—Ç–∏ A/B-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫—É.  
    """)
